(()=>{"use strict";var e={899:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),t.nonce=void 0,t.nonce={},r(o(871),t)},871:function(e,t,o){var n=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},r=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function i(e){try{a(n.next(e))}catch(e){s(e)}}function c(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectorConnector=void 0;const s=o(938),i=o(760),c=o(263),a=o(318),p=c("msteams");let u=class{constructor(){this.connectors=new a("connectors",!0,!1)}Connect(e){var t;return r(this,void 0,void 0,(function*(){try{const o={email:e.body.email,password:e.body.password,webhook:e.body.webhookUrl};return yield s.default.post(null!==(t=process.env.BACKEND_ENDPOINT)&&void 0!==t?t:"",o).then((t=>(console.log("Response: ",t),console.log(`Response from Connector endpoint is: ${t.status}`),200!==t.status&&302!==t.status||this.connectors.push("/connectors[]",{appType:e.body.appType,existing:!0,groupName:e.body.groupName,user:e.body.user,webhookUrl:e.body.webhookUrl}),t))).catch((e=>{throw e.response?(console.log("axios - catch",e.response),console.log(e.response.data),console.log(e.response.status),console.log(e.response.headers),new Error("Invalid Credentials")):(console.log("axios - catch-else",e),new Error("Invalid Credentials"))}))}catch(e){throw console.log("axios - outer-catch",e),new Error("Invalid Credentials")}}))}Ping(e){try{this.connectors.push("/connectors",this.connectors.getData("/connectors").filter((e=>e.existing)))}catch(e){if(e.name&&"DataError"===e.name)return[];throw e}return this.connectors.getData("/connectors").map(((e,t)=>new Promise(((o,n)=>{const r={title:"Sample Connector",text:"This is a sample Office 365 Connector",sections:[{activityTitle:"Ping",activityText:"Sample ping ",activityImage:`https://${process.env.PUBLIC_HOSTNAME}/assets/icon.png`,facts:[{name:"Generator",value:"teams"},{name:"Created by",value:e.user}]}],potentialAction:[{"@context":"http://schema.org","@type":"ViewAction",name:"Yo Teams",target:["http://aka.ms/yoteams"]}]};p(`Sending card to ${e.webhookUrl}`),s.default.post(decodeURI(e.webhookUrl),JSON.stringify(r)).then((e=>{p(`Response from Connector endpoint is: ${e.status}`),o()})).catch((e=>{e.response&&410===e.response.status?(this.connectors.push(`/connectors[${t}]/existing`,!1),p(`Response from Connector endpoint is: ${e.response.status}, add Connector for removal`),o()):(p(`Error from Connector endpoint is: ${e}`),n(e))}))}))))}};u=n([i.ConnectorDeclaration("/api/connector/connect","/api/connector/ping"),i.PreventIframe("/connectorConnector/config.html")],u),t.ConnectorConnector=u},938:e=>{e.exports=require("axios")},174:e=>{e.exports=require("compression")},263:e=>{e.exports=require("debug")},818:e=>{e.exports=require("dotenv")},252:e=>{e.exports=require("express")},760:e=>{e.exports=require("express-msteams-host")},96:e=>{e.exports=require("morgan")},318:e=>{e.exports=require("node-json-db")},611:e=>{e.exports=require("http")},928:e=>{e.exports=require("path")}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,o),s.exports}(()=>{const e=o(252),t=o(611),n=o(928),r=o(96),s=o(760),i=o(263),c=o(174),a=i("msteams");a("Initializing Microsoft Teams Express hosted App..."),o(818).config();const p=o(899),u=e(),l=process.env.port||process.env.PORT||3007;u.use(e.json({verify:(e,t,o,n)=>{e.rawBody=o.toString()}})),u.use(e.urlencoded({extended:!0})),u.set("views",n.join(__dirname,"/")),u.use(r("tiny")),u.use(c()),u.use("/scripts",e.static(n.join(__dirname,"web/scripts"))),u.use("/assets",e.static(n.join(__dirname,"web/assets"))),u.use(s.MsTeamsApiRouter(p)),u.use(s.MsTeamsPageRouter({root:n.join(__dirname,"web/"),components:p})),u.use("/",e.static(n.join(__dirname,"web/"),{index:"index.html"})),u.set("port",l),t.createServer(u).listen(l,(()=>{a(`Server running on ${l}`)}))})()})();
//# sourceMappingURL=server.js.map